<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•™íšŒ ë„ìš°ë¯¸ | Conference Helper</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f0f1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%); 
            min-height: 100vh; 
            color: #fff; 
            padding: 10px; 
            padding-bottom: env(safe-area-inset-bottom); 
        }
        .container { max-width: 600px; margin: 0 auto; }
        .header { text-align: center; padding: 15px 0; margin-bottom: 15px; }
        .header h1 { 
            font-size: 1.5em; 
            background: linear-gradient(90deg, #00d9ff, #00ff88); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 5px; 
        }
        .header p { font-size: 0.85em; color: #888; }
        .card { 
            background: rgba(255, 255, 255, 0.08); 
            border-radius: 16px; 
            padding: 15px; 
            margin-bottom: 12px; 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .card-title { 
            font-size: 0.9em; 
            color: #00d9ff; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .lang-settings { display: flex; flex-direction: column; gap: 10px; }
        .lang-row { display: flex; align-items: center; gap: 10px; }
        .lang-label { font-size: 0.85em; color: #aaa; min-width: 80px; }
        select { 
            flex: 1; 
            padding: 10px 12px; 
            border-radius: 10px; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            background: rgba(0, 0, 0, 0.3); 
            color: #fff; 
            font-size: 0.95em; 
            cursor: pointer; 
        }
        select option { background: #1a1a2e; color: #fff; }
        .video-wrapper { 
            position: relative; 
            width: 100%; 
            border-radius: 12px; 
            overflow: hidden; 
            background: #000; 
            min-height: 200px; 
        }
        #videoElement { width: 100%; display: block; }
        .subtitle-container { 
            position: absolute; 
            bottom: 15px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 94%; 
            text-align: center; 
        }
        .subtitle-text { 
            display: inline-block; 
            padding: 12px 20px; 
            background: rgba(0, 0, 0, 0.85); 
            border-radius: 8px; 
            font-size: 1.2em; 
            line-height: 1.5; 
            max-width: 100%; 
            word-break: keep-all; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8); 
        }
        .subtitle-text.interim { color: #aaa; font-style: italic; }
        .subtitle-text.final { color: #fff; }
        .subtitle-text.empty { color: #888; font-size: 1em; background: rgba(0, 0, 0, 0.6); }
        .status-bar { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            padding: 10px; 
            margin-bottom: 10px; 
        }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #ff4757; }
        .status-dot.active { background: #00ff88; animation: pulse 1.5s infinite; }
        @keyframes pulse { 
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.5); } 
            50% { box-shadow: 0 0 0 8px rgba(0, 255, 136, 0); } 
        }
        .status-text { font-size: 0.85em; color: #888; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { 
            padding: 16px 20px; 
            border: none; 
            border-radius: 12px; 
            font-size: 1em; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
        }
        .btn-primary { background: linear-gradient(135deg, #00d9ff, #00ff88); color: #0f0f1a; grid-column: span 2; }
        .btn-stop { background: linear-gradient(135deg, #ff6b6b, #ff8e53); color: #fff; grid-column: span 2; }
        .btn-secondary { background: rgba(255, 255, 255, 0.15); color: #fff; }
        .btn-capture { background: linear-gradient(135deg, #a855f7, #ec4899); color: #fff; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .transcript-box { 
            background: rgba(0, 0, 0, 0.3); 
            border-radius: 12px; 
            padding: 15px; 
            max-height: 250px; 
            overflow-y: auto; 
            font-size: 0.9em; 
        }
        .transcript-box:empty::before { content: 'ìŒì„±ì¸ì‹ì„ ì‹œì‘í•˜ë©´ ë²ˆì—­ ê¸°ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤...'; color: #555; }
        .transcript-item { 
            padding: 12px; 
            margin-bottom: 10px; 
            background: rgba(255, 255, 255, 0.05); 
            border-radius: 10px; 
            border-left: 3px solid #00d9ff; 
        }
        .transcript-time { font-size: 0.75em; color: #666; margin-bottom: 6px; }
        .transcript-original { color: #aaa; font-size: 0.85em; margin-bottom: 4px; }
        .transcript-translated { color: #fff; font-size: 1em; line-height: 1.5; }
        .toast { 
            position: fixed; 
            bottom: 80px; 
            left: 50%; 
            transform: translateX(-50%) translateY(100px); 
            padding: 12px 24px; 
            background: rgba(0, 255, 136, 0.9); 
            color: #0f0f1a; 
            border-radius: 25px; 
            font-size: 0.9em; 
            font-weight: 600; 
            transition: transform 0.3s ease; 
            z-index: 1000; 
            white-space: nowrap; 
        }
        .toast.show { transform: translateX(-50%) translateY(0); }
        .warning { 
            background: rgba(255, 107, 107, 0.2); 
            border: 1px solid rgba(255, 107, 107, 0.5); 
            border-radius: 10px; 
            padding: 12px; 
            margin-bottom: 12px; 
            font-size: 0.85em; 
            display: none; 
        }
        .warning.show { display: block; }
        .transcript-box::-webkit-scrollbar { width: 4px; }
        .transcript-box::-webkit-scrollbar-track { background: transparent; }
        .transcript-box::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 2px; }
        .camera-toggle { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-top: 10px; 
            padding: 10px; 
            background: rgba(0,0,0,0.2); 
            border-radius: 8px; 
        }
        .camera-toggle label { font-size: 0.85em; color: #aaa; }
        .toggle-switch { position: relative; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { 
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #333; transition: .3s; border-radius: 26px; 
        }
        .slider:before { 
            position: absolute; content: ""; height: 20px; width: 20px; 
            left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; 
        }
        input:checked + .slider { background: linear-gradient(135deg, #00d9ff, #00ff88); }
        input:checked + .slider:before { transform: translateX(24px); }
        .gallery-section { margin-top: 15px; }
        .gallery-title { font-size: 0.85em; color: #888; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .gallery-item { 
            position: relative; aspect-ratio: 16/9; border-radius: 8px; 
            overflow: hidden; cursor: pointer; transition: transform 0.2s; 
        }
        .gallery-item:hover { transform: scale(1.02); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-item .delete-btn { 
            position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; 
            background: rgba(255, 0, 0, 0.8); border: none; border-radius: 50%; 
            color: white; font-size: 14px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            opacity: 0; transition: opacity 0.2s; 
        }
        .gallery-item:hover .delete-btn { opacity: 1; }
        .gallery-empty { grid-column: span 3; text-align: center; padding: 30px; color: #555; font-size: 0.85em; }
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 2000; 
            align-items: center; justify-content: center; flex-direction: column; padding: 20px;
        }
        .modal.show { display: flex; }
        .modal img { max-width: 100%; max-height: 70vh; border-radius: 8px; }
        .modal-buttons { display: flex; gap: 15px; margin-top: 20px; }
        .modal-btn { padding: 12px 24px; border: none; border-radius: 25px; font-size: 1em; cursor: pointer; transition: transform 0.2s; }
        .modal-btn:active { transform: scale(0.95); }
        .modal-btn.download { background: #00ff88; color: #0f0f1a; }
        .modal-btn.close { background: rgba(255,255,255,0.2); color: #fff; }
        #captureCanvas { display: none; }
        @media (min-width: 768px) { .container { max-width: 700px; } .subtitle-text { font-size: 1.6em; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ í•™íšŒ ë„ìš°ë¯¸</h1>
            <p>Conference Helper - Real-time Translation Subtitles</p>
        </div>
        <div class="warning" id="warning">âš ï¸ Please use Chrome or Edge browser.</div>
        <div class="card">
            <div class="card-title">ğŸŒ Language Settings</div>
            <div class="lang-settings">
                <div class="lang-row">
                    <span class="lang-label">Recognition</span>
                    <select id="recognitionLang">
                        <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>
                        <option value="ko-KR">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                        <option value="ja-JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                        <option value="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                        <option value="de-DE">ğŸ‡©ğŸ‡ª Deutsch</option>
                        <option value="fr-FR">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="es-ES">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    </select>
                </div>
                <div class="lang-row">
                    <span class="lang-label">Translation</span>
                    <select id="translateLang">
                        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    </select>
                </div>
                <div class="camera-toggle">
                    <label>ğŸ“· Camera</label>
                    <label class="toggle-switch"><input type="checkbox" id="cameraToggle" checked><span class="slider"></span></label>
                    <select id="cameraFacing" style="flex:1; margin-left:10px;">
                        <option value="environment">Back Camera</option>
                        <option value="user">Front Camera</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">ğŸ“º Live Subtitles</div>
            <div class="status-bar"><div class="status-dot" id="statusDot"></div><span class="status-text" id="statusText">Ready</span></div>
            <div class="video-wrapper" id="videoWrapper">
                <video id="videoElement" autoplay playsinline></video>
                <div class="subtitle-container"><div class="subtitle-text empty" id="subtitleText">Press Start button</div></div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" id="startBtn" onclick="startAll()">â–¶ï¸ Start</button>
                <button class="btn btn-stop" id="stopBtn" onclick="stopAll()" style="display: none;">â¹ï¸ Stop</button>
                <button class="btn btn-capture" onclick="captureWithSubtitle()">ğŸ“¸ Capture</button>
                <button class="btn btn-secondary" onclick="saveTranscript()">ğŸ’¾ Save Log</button>
            </div>
            <div class="gallery-section">
                <div class="gallery-title">ğŸ–¼ï¸ Captured Images (<span id="captureCount">0</span>)</div>
                <div class="gallery-grid" id="galleryGrid"><div class="gallery-empty">No captures yet</div></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">ğŸ“ Translation Log</div>
            <div class="transcript-box" id="transcriptBox"></div>
            <div class="btn-group" style="margin-top:10px;">
                <button class="btn btn-secondary" onclick="clearTranscript()">ğŸ—‘ï¸ Clear Log</button>
                <button class="btn btn-secondary" onclick="clearGallery()">ğŸ—‘ï¸ Clear Images</button>
            </div>
        </div>
    </div>
    <div class="toast" id="toast"></div>
    <div class="modal" id="imageModal">
        <img id="modalImage" src="" alt="Captured image">
        <div class="modal-buttons">
            <button class="modal-btn download" onclick="downloadModalImage()">ğŸ’¾ Download</button>
            <button class="modal-btn close" onclick="closeModal()">âœ• Close</button>
        </div>
    </div>
    <canvas id="captureCanvas"></canvas>
    <script>
        let recognition = null, isRecognizing = false, videoStream = null, capturedImages = [], currentModalImage = null;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) document.getElementById('warning').classList.add('show');
        
        function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2500); }
        function getTimeString() { return new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }); }
        function getDateTimeString() { return new Date().toISOString().slice(0, 19).replace(/[T:]/g, '-'); }
        
        async function translateText(text, targetLang) {
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`);
                const data = await res.json();
                return data[0].map(item => item[0]).join('');
            } catch (e) { return text; }
        }
        
        async function startCamera() {
            if (!document.getElementById('cameraToggle').checked) { document.getElementById('videoWrapper').style.minHeight = '100px'; return true; }
            try {
                const facingMode = document.getElementById('cameraFacing').value;
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode, width: 1280, height: 720 }, audio: false });
                document.getElementById('videoElement').srcObject = videoStream;
                document.getElementById('videoWrapper').style.minHeight = '200px';
                return true;
            } catch (e) { showToast('Camera permission required'); return true; }
        }
        
        function stopCamera() { if (videoStream) { videoStream.getTracks().forEach(t => t.stop()); videoStream = null; document.getElementById('videoElement').srcObject = null; } }
        
        function captureWithSubtitle() {
            const video = document.getElementById('videoElement');
            const subtitleEl = document.getElementById('subtitleText');
            const canvas = document.getElementById('captureCanvas');
            const ctx = canvas.getContext('2d');
            if (!videoStream || video.videoWidth === 0) { showToast('Please start camera first'); return; }
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const subtitleText = subtitleEl.textContent;
            if (subtitleText && subtitleText !== 'Press Start button' && subtitleText !== 'Waiting for speech...') {
                const fontSize = Math.max(24, canvas.width / 25);
                ctx.font = `bold ${fontSize}px -apple-system, BlinkMacSystemFont, sans-serif`;
                const maxWidth = canvas.width * 0.9;
                let lines = [], currentLine = '';
                for (let char of subtitleText) {
                    const testLine = currentLine + char;
                    if (ctx.measureText(testLine).width > maxWidth && currentLine !== '') { lines.push(currentLine); currentLine = char; }
                    else currentLine = testLine;
                }
                lines.push(currentLine);
                const lineHeight = fontSize * 1.4, padding = 20;
                const boxHeight = lines.length * lineHeight + padding * 2;
                const boxY = canvas.height - boxHeight - 30;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.85)';
                ctx.beginPath(); ctx.roundRect(canvas.width * 0.03, boxY, canvas.width * 0.94, boxHeight, 12); ctx.fill();
                ctx.fillStyle = '#ffffff'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                lines.forEach((line, i) => ctx.fillText(line, canvas.width / 2, boxY + padding + (i + 0.5) * lineHeight));
                ctx.font = `${fontSize * 0.5}px -apple-system, sans-serif`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'; ctx.textAlign = 'right';
                ctx.fillText(getTimeString(), canvas.width - 20, 30);
            }
            const imageData = canvas.toDataURL('image/png');
            capturedImages.push({ id: Date.now(), image: imageData, subtitle: subtitleText, time: getTimeString() });
            updateGallery();
            showToast('ğŸ“¸ Captured with subtitle!');
        }
        
        function updateGallery() {
            const gallery = document.getElementById('galleryGrid');
            document.getElementById('captureCount').textContent = capturedImages.length;
            if (capturedImages.length === 0) { gallery.innerHTML = '<div class="gallery-empty">No captures yet</div>'; return; }
            gallery.innerHTML = capturedImages.map((item, i) => `<div class="gallery-item" onclick="openModal(${i})"><img src="${item.image}" alt="Capture ${i+1}"><button class="delete-btn" onclick="event.stopPropagation(); deleteCapture(${i})">Ã—</button></div>`).join('');
        }
        
        function openModal(i) { currentModalImage = capturedImages[i]; document.getElementById('modalImage').src = currentModalImage.image; document.getElementById('imageModal').classList.add('show'); }
        function closeModal() { document.getElementById('imageModal').classList.remove('show'); currentModalImage = null; }
        function downloadModalImage() {
            if (!currentModalImage) return;
            const a = document.createElement('a'); a.download = `conference_capture_${getDateTimeString()}.png`; a.href = currentModalImage.image;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            showToast('ğŸ’¾ Image downloaded!');
        }
        function deleteCapture(i) { capturedImages.splice(i, 1); updateGallery(); showToast('ğŸ—‘ï¸ Deleted'); }
        function clearGallery() { if (capturedImages.length === 0) { showToast('No images to clear'); return; } if (confirm('Delete all captured images?')) { capturedImages = []; updateGallery(); showToast('ğŸ—‘ï¸ All images cleared'); } }
        
        function initSpeechRecognition() {
            if (!SpeechRecognition) return null;
            recognition = new SpeechRecognition();
            recognition.continuous = true; recognition.interimResults = true;
            recognition.lang = document.getElementById('recognitionLang').value;
            recognition.onstart = () => { isRecognizing = true; document.getElementById('statusDot').classList.add('active'); document.getElementById('statusText').textContent = 'Listening...'; document.getElementById('startBtn').style.display = 'none'; document.getElementById('stopBtn').style.display = 'flex'; };
            recognition.onend = () => { if (isRecognizing) { try { recognition.start(); } catch(e){} } else { document.getElementById('statusDot').classList.remove('active'); document.getElementById('statusText').textContent = 'Ready'; document.getElementById('startBtn').style.display = 'flex'; document.getElementById('stopBtn').style.display = 'none'; } };
            recognition.onerror = (e) => { if (e.error === 'not-allowed') showToast('Microphone permission required'); };
            recognition.onresult = async (e) => {
                const subtitleEl = document.getElementById('subtitleText');
                let interim = '', final = '';
                for (let i = e.resultIndex; i < e.results.length; i++) { if (e.results[i].isFinal) final += e.results[i][0].transcript; else interim += e.results[i][0].transcript; }
                if (final) {
                    subtitleEl.textContent = final; subtitleEl.className = 'subtitle-text final';
                    const translated = await translateText(final, document.getElementById('translateLang').value);
                    addToTranscript(final, translated);
                    setTimeout(() => { if (subtitleEl.textContent === final) { subtitleEl.className = 'subtitle-text empty'; subtitleEl.textContent = 'Waiting for speech...'; } }, 5000);
                } else if (interim) { subtitleEl.textContent = interim; subtitleEl.className = 'subtitle-text interim'; }
            };
            return recognition;
        }
        
        async function startAll() { await startCamera(); startRecognition(); showToast('â–¶ï¸ Started'); }
        function stopAll() { stopRecognition(); stopCamera(); showToast('â¹ï¸ Stopped'); }
        function startRecognition() { if (!recognition) recognition = initSpeechRecognition(); if (recognition) { recognition.lang = document.getElementById('recognitionLang').value; try { recognition.start(); } catch(e){} } }
        function stopRecognition() { isRecognizing = false; if (recognition) try { recognition.stop(); } catch(e){} const s = document.getElementById('subtitleText'); s.className = 'subtitle-text empty'; s.textContent = 'Press Start button'; }
        
        function addToTranscript(original, translated) {
            const box = document.getElementById('transcriptBox');
            const item = document.createElement('div'); item.className = 'transcript-item';
            item.innerHTML = `<div class="transcript-time">${getTimeString()}</div><div class="transcript-original">${original}</div><div class="transcript-translated">${translated}</div>`;
            box.appendChild(item); box.scrollTop = box.scrollHeight;
        }
        function clearTranscript() { document.getElementById('transcriptBox').innerHTML = ''; showToast('ğŸ—‘ï¸ Log cleared'); }
        function saveTranscript() {
            const items = document.getElementById('transcriptBox').querySelectorAll('.transcript-item');
            if (items.length === 0) { showToast('No records to save'); return; }
            let content = '=== Conference Helper - Translation Log ===\n';
            content += `Saved: ${new Date().toLocaleString()}\nRecognition: ${document.getElementById('recognitionLang').selectedOptions[0].text}\nTranslation: ${document.getElementById('translateLang').selectedOptions[0].text}\n==========================================\n\n`;
            items.forEach(item => { content += `[${item.querySelector('.transcript-time').textContent}]\nOriginal: ${item.querySelector('.transcript-original').textContent}\nTranslated: ${item.querySelector('.transcript-translated').textContent}\n\n`; });
            const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([content], { type: 'text/plain;charset=utf-8' })); a.download = `conference_log_${getDateTimeString()}.txt`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            showToast('ğŸ’¾ Log saved');
        }
        
        document.getElementById('recognitionLang').addEventListener('change', () => { if (isRecognizing && recognition) { recognition.stop(); recognition = null; setTimeout(() => { recognition = initSpeechRecognition(); if (recognition) recognition.start(); showToast('ğŸŒ Language changed'); }, 200); } });
        document.getElementById('cameraFacing').addEventListener('change', async () => { if (videoStream) { stopCamera(); await startCamera(); } });
        document.getElementById('imageModal').addEventListener('click', (e) => { if (e.target.id === 'imageModal') closeModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
        window.onbeforeunload = stopAll;
        if ('serviceWorker' in navigator && !location.hostname.includes('claudeusercontent')) navigator.serviceWorker.register('sw.js').catch(e => {});
    </script>
</body>
</html>
